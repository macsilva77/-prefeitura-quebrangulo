<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prefeitura de Quebrangulo - Sistema de Controle de Pagamentos</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    
    <!-- SheetJS (Excel) -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>
<body class="bg-slate-100 text-slate-900">
    <div class="min-h-screen flex">
        <!-- Sidebar -->
        <aside id="sidebar" class="w-72 bg-gradient-to-b from-slate-900 to-slate-800 text-white p-6 shadow-lg fixed h-screen overflow-y-auto transition-all duration-300 z-40">
            <div class="flex items-center justify-between mb-8">
                <div class="flex-1">
                    <h1 class="text-2xl font-bold mb-1">Prefeitura de Quebrangulo</h1>
                    <p class="text-slate-400 text-sm">Controle de Pagamentos</p>
                </div>
                <button id="toggleSidebar" class="ml-4 text-slate-300 hover:text-white transition" title="Recolher menu">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                    </svg>
                </button>
            </div>

            <!-- Menu Search -->
            <div class="mb-6">
                <input id="menuSearch" type="text" placeholder="üîç Pesquisar..." class="w-full px-3 py-2 rounded-lg bg-slate-700 text-white placeholder-slate-400 focus:ring-2 focus:ring-blue-500 focus:outline-none transition text-sm">
            </div>

            <nav class="space-y-2 mb-8">
                <button class="nav-btn w-full text-left px-4 py-3 rounded-lg transition-all bg-slate-700" data-page="dashboard">
                    <span class="text-lg mr-2">üìä</span>Dashboard
                </button>
                <button class="nav-btn w-full text-left px-4 py-3 rounded-lg transition-all hover:bg-slate-700" data-page="import">
                    <span class="text-lg mr-2">üì•</span>Importa√ß√£o
                </button>
                <button class="nav-btn w-full text-left px-4 py-3 rounded-lg transition-all hover:bg-slate-700" data-page="data">
                    <span class="text-lg mr-2">üìã</span>Dados
                </button>
            </nav>

            <hr class="border-slate-700 my-6">

            <div>
                <div class="text-sm font-semibold text-slate-300 mb-3">Administra√ß√£o</div>
                <a href="fornecedores.html" class="block w-full text-left px-4 py-2 rounded-lg transition-all hover:bg-slate-700 text-sm">
                    <span class="mr-2">üè¢</span>Fornecedores
                </a>
                <a href="secretarias.html" class="block w-full text-left px-4 py-2 rounded-lg transition-all hover:bg-slate-700 text-sm">
                    <span class="mr-2">üèõÔ∏è</span>Secretarias
                </a>
                <a href="usuarios.html" class="block w-full text-left px-4 py-2 rounded-lg transition-all hover:bg-slate-700 text-sm">
                    <span class="mr-2">üë•</span>Usu√°rios
                </a>
            </div>

            <div class="mt-8 pt-6 border-t border-slate-700 text-xs text-slate-500">
                v1.0 ‚Ä¢ Sistema Profissional
            </div>
        </aside>

        <!-- Main Content -->
        <main id="mainContent" class="flex-1 ml-72 p-8 overflow-y-auto transition-all duration-300">
            <!-- Top Header with User Info and Logout -->
            <div class="bg-gradient-to-r from-blue-900 to-blue-800 text-white rounded-xl shadow-md p-6 mb-8 flex justify-between items-center">
                <div>
                    <p class="text-sm text-blue-100">Bem-vindo</p>
                    <h2 class="text-2xl font-bold" id="usuarioNome">Carregando...</h2>
                </div>
                <div class="flex items-center gap-6">
                    <!-- User Info Right Side -->
                    <div class="text-right">
                        <p class="text-sm text-blue-100">Usu√°rio logado:</p>
                        <p class="text-lg font-semibold" id="usuarioNomeCompleto">-</p>
                        <p class="text-xs text-blue-200" id="usuarioEmail">-</p>
                    </div>
                    <div class="w-px h-12 bg-blue-700"></div>
                    <div class="flex flex-col gap-2">
                        <button id="btnLogout" class="bg-red-600 hover:bg-red-700 px-4 py-2 rounded-lg font-semibold transition-all text-sm">
                            üö™ Sair
                        </button>
                        <button id="btnConfiguracao" class="bg-blue-700 hover:bg-blue-600 px-4 py-2 rounded-lg font-semibold transition-all text-sm" title="Configura√ß√µes">
                            ‚öôÔ∏è Config
                        </button>
                    </div>
                </div>
            </div>

            <!-- Header -->
            <div class="bg-white rounded-xl shadow-md p-6 mb-8">
                <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
                    <div>
                        <p class="text-sm text-slate-500 font-semibold">SISTEMA DE CONTROLE</p>
                        <h2 class="text-3xl font-bold mt-1">Prefeitura de Quebrangulo</h2>
                        <p class="text-slate-600 text-sm mt-2 max-w-2xl">
                            Sistema integrado para controle de pagamentos de fornecedores, com vis√£o geral e por secretaria.
                        </p>
                    </div>
                    <div class="text-right">
                        <p class="text-xs text-slate-500">Vers√£o</p>
                        <p class="text-2xl font-bold">1.0</p>
                    </div>
                </div>
            </div>

            <!-- Views Container -->
            <div id="viewsContainer">
                <!-- Dashboard View -->
                <div id="viewDashboard" class="space-y-6">
                    <!-- Controls Bar -->
                    <div class="bg-white rounded-xl shadow-md p-6 flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4">
                        <div>
                            <h3 class="text-2xl font-bold">Dashboard</h3>
                            <p class="text-slate-600 text-sm mt-1">Vis√£o geral e an√°lise por secretaria</p>
                        </div>
                        <div class="flex flex-col sm:flex-row gap-3">
                            <select id="secretariaFilter" class="px-4 py-2 rounded-lg border border-slate-300 bg-white focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="__geral__">Geral (todas as secretarias)</option>
                            </select>
                            <select id="periodoFilter" class="px-4 py-2 rounded-lg border border-slate-300 bg-white focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="2026-01">Jan/2026</option>
                                <option value="2025-12">Dez/2025</option>
                                <option value="2025-11">Nov/2025</option>
                            </select>
                            <button id="btnRefresh" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-semibold shadow-md">
                                Atualizar
                            </button>
                        </div>
                    </div>

                    <!-- KPI Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        <div class="bg-white rounded-xl shadow-md p-6 border-l-4 border-blue-500">
                            <p class="text-sm text-slate-600 font-semibold">Total Pago</p>
                            <p class="text-3xl font-bold mt-2" id="kpiTotalPago">R$ 0,00</p>
                            <p class="text-xs text-slate-500 mt-2">Somat√≥rio dos pagamentos</p>
                        </div>
                        <div class="bg-white rounded-xl shadow-md p-6 border-l-4 border-emerald-500">
                            <p class="text-sm text-slate-600 font-semibold">Maior Fornecedor</p>
                            <p class="text-lg font-bold mt-2" id="kpiMaiorFornecedor">‚Äî</p>
                            <p class="text-xs text-slate-500 mt-2" id="kpiMaiorFornecedorValor">R$ 0,00</p>
                        </div>
                        <div class="bg-white rounded-xl shadow-md p-6 border-l-4 border-purple-500">
                            <p class="text-sm text-slate-600 font-semibold">Verba Recebida</p>
                            <p class="text-3xl font-bold mt-2" id="kpiVerbaRecebida">R$ 0,00</p>
                            <p class="text-xs text-slate-500 mt-2">Total de repasses</p>
                        </div>
                        <div class="bg-white rounded-xl shadow-md p-6 border-l-4 border-orange-500">
                            <p class="text-sm text-slate-600 font-semibold">Disparidade</p>
                            <p class="text-3xl font-bold mt-2" id="kpiDisparidade">R$ 0,00</p>
                            <p class="text-xs text-slate-500 mt-2">Recebida - Aplicada</p>
                        </div>
                    </div>

                    <!-- Charts Grid Section 1: Pizza e Top Fornecedores lado a lado -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- Pizza Chart (Left) -->
                        <div class="bg-gradient-to-br from-white to-slate-50 rounded-xl shadow-lg p-6 border border-slate-100">
                            <div class="flex items-center justify-between mb-6">
                                <div>
                                    <h3 class="font-bold text-xl text-slate-800">Gastos por Secretaria</h3>
                                    <p class="text-xs text-slate-500 mt-1">Distribui√ß√£o de gastos</p>
                                </div>
                                <span class="text-2xl">üìä</span>
                            </div>
                            <canvas id="chartGastosPizza"></canvas>
                            <p class="text-xs text-slate-500 mt-4 text-center bg-blue-50 py-2 rounded">üí° Clique na pizza para filtrar</p>
                        </div>

                        <!-- Top Fornecedores (Right) -->
                        <div class="bg-gradient-to-br from-white to-slate-50 rounded-xl shadow-lg p-6 border border-slate-100">
                            <div class="flex items-center justify-between mb-6">
                                <div>
                                    <h3 class="font-bold text-xl text-slate-800">Top Fornecedores</h3>
                                    <p class="text-xs text-slate-500 mt-1">Maiores gastos</p>
                                </div>
                                <span class="text-2xl">üè¢</span>
                            </div>
                            <canvas id="chartTopFornecedores"></canvas>
                        </div>
                    </div>

                    <!-- Charts Grid Section 2: Verba Recebida x Paga - Full Width -->
                    <div class="bg-gradient-to-br from-white to-slate-50 rounded-xl shadow-lg p-6 border border-slate-100">
                        <div class="flex items-center justify-between mb-6">
                            <div>
                                <h3 class="font-bold text-xl text-slate-800">Verba Recebida x Verba Paga por Secretaria</h3>
                                <p class="text-xs text-slate-500 mt-1">Compara√ß√£o empilhada por secretaria</p>
                            </div>
                            <span class="text-2xl">üí∞</span>
                        </div>
                        <canvas id="chartVerbasPorSecretaria"></canvas>
                    </div>

                    <!-- Hidden Chart for Secretaria View -->
                    <div id="boxTopFornecedoresSecretaria" class="hidden bg-gradient-to-br from-white to-slate-50 rounded-xl shadow-lg p-6 border border-slate-100">
                        <div class="flex items-center justify-between mb-6">
                            <div>
                                <h3 class="font-bold text-xl text-slate-800" id="titlePizzaSecretaria">Top Fornecedores da Secretaria</h3>
                                <p class="text-xs text-slate-500 mt-1">Maiores gastos nesta secretaria</p>
                            </div>
                            <span class="text-2xl">üìà</span>
                        </div>
                        <canvas id="chartFornecedoresSecretariaPizza"></canvas>
                    </div>

                    <!-- Disparidade Table -->
                    <div class="bg-white rounded-xl shadow-md overflow-hidden">
                        <div class="p-6 border-b border-slate-200 flex items-center justify-between">
                            <h3 class="font-bold text-lg">Disparidade por Secretaria</h3>
                            <span class="text-xs text-slate-500" id="labelPeriodoDisparidade">Per√≠odo: ‚Äî</span>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm">
                                <thead class="bg-slate-50 text-slate-700 font-semibold">
                                    <tr>
                                        <th class="text-left p-4">Secretaria</th>
                                        <th class="text-right p-4">Recebida</th>
                                        <th class="text-right p-4">Aplicada</th>
                                        <th class="text-right p-4">Disparidade</th>
                                        <th class="text-right p-4">% Aplicada</th>
                                    </tr>
                                </thead>
                                <tbody id="tblDisparidade" class="divide-y divide-slate-200"></tbody>
                            </table>
                        </div>
                        <div class="p-4 bg-slate-50 text-xs text-slate-600" id="tblDisparidadeFooter">0 secretarias</div>
                    </div>

                    <!-- Pagamentos Table -->
                    <div class="bg-white rounded-xl shadow-md overflow-hidden">
                        <div class="p-6 border-b border-slate-200 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                            <h3 class="font-bold text-lg">Pagamentos (Detalhe)</h3>
                            <input id="searchFornecedor" class="px-4 py-2 rounded-lg border border-slate-300 focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm w-full sm:w-64" 
                                placeholder="Buscar fornecedor...">
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm">
                                <thead class="bg-slate-50 text-slate-700 font-semibold">
                                    <tr>
                                        <th class="text-left p-4">Data</th>
                                        <th class="text-left p-4">Secretaria</th>
                                        <th class="text-left p-4">Fornecedor</th>
                                        <th class="text-left p-4">Documento</th>
                                        <th class="text-right p-4">Valor</th>
                                    </tr>
                                </thead>
                                <tbody id="tblPagamentos" class="divide-y divide-slate-200"></tbody>
                            </table>
                        </div>
                        <div class="p-4 bg-slate-50 text-xs text-slate-600" id="tblFooter">0 registros</div>
                    </div>
                </div>

                <!-- Import View -->
                <div id="viewImport" class="hidden space-y-6">
                    <div class="bg-white rounded-xl shadow-md p-6">
                        <h3 class="text-2xl font-bold mb-4">Importa√ß√£o de Dados</h3>
                        <p class="text-slate-600 mb-6">Importe dados de pagamentos e verbas via Excel ou API.</p>

                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <div class="border-2 border-slate-200 rounded-lg p-6">
                                <h4 class="font-bold text-lg mb-2">üìä Importar Excel</h4>
                                <p class="text-slate-600 text-sm mb-4">Esperamos 2 abas: <span class="font-semibold">Pagamentos</span> e <span class="font-semibold">Verbas</span></p>
                                <input type="file" id="excelFile" accept=".xlsx,.xls" class="mb-4 w-full">
                                <button id="btnImportExcel" class="w-full px-4 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 transition-colors font-semibold">
                                    Importar Excel
                                </button>
                                <p class="text-xs text-slate-500 mt-3">M√°ximo 10MB ‚Ä¢ Formatos: .xlsx, .xls</p>
                            </div>

                            <div class="border-2 border-slate-200 rounded-lg p-6">
                                <h4 class="font-bold text-lg mb-2">üîå Conectar API</h4>
                                <p class="text-slate-600 text-sm mb-4">Busque dados atrav√©s de endpoints configurados.</p>
                                <input id="apiBaseUrl" class="w-full px-4 py-2 rounded-lg border border-slate-300 mb-3 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent" 
                                    placeholder="Ex: https://api.prefeitura.gov.br">
                                <button id="btnFetchApi" class="w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-semibold">
                                    Buscar via API
                                </button>
                                <p class="text-xs text-slate-500 mt-3">Modo: simula√ß√£o (prot√≥tipo)</p>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl shadow-md p-6">
                        <h3 class="font-bold text-lg mb-4">üìã Modelo de Excel</h3>
                        <p class="text-slate-600 text-sm mb-4">Crie um arquivo com as seguintes estruturas:</p>

                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                            <div class="bg-slate-50 rounded-lg p-4">
                                <p class="font-semibold text-slate-900 mb-3">Aba: Pagamentos</p>
                                <ul class="text-sm text-slate-700 space-y-1">
                                    <li>‚Ä¢ <span class="font-mono">data_pagamento</span> (YYYY-MM-DD)</li>
                                    <li>‚Ä¢ <span class="font-mono">periodo</span> (ex: 2026-01)</li>
                                    <li>‚Ä¢ <span class="font-mono">secretaria</span></li>
                                    <li>‚Ä¢ <span class="font-mono">fornecedor</span></li>
                                    <li>‚Ä¢ <span class="font-mono">documento</span> (NF/Empenho)</li>
                                    <li>‚Ä¢ <span class="font-mono">valor</span> (n√∫mero)</li>
                                </ul>
                            </div>

                            <div class="bg-slate-50 rounded-lg p-4">
                                <p class="font-semibold text-slate-900 mb-3">Aba: Verbas</p>
                                <ul class="text-sm text-slate-700 space-y-1">
                                    <li>‚Ä¢ <span class="font-mono">periodo</span> (ex: 2026-01)</li>
                                    <li>‚Ä¢ <span class="font-mono">secretaria</span></li>
                                    <li>‚Ä¢ <span class="font-mono">verba_recebida</span> (n√∫mero)</li>
                                    <li>‚Ä¢ <span class="font-mono">verba_destinada_especifica</span></li>
                                    <li>‚Ä¢ <span class="font-mono">verba_aplicada</span> (n√∫mero)</li>
                                    <li>‚Ä¢ <span class="font-mono">observacao</span> (opcional)</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Data View -->
                <div id="viewData" class="hidden space-y-6">
                    <div class="bg-white rounded-xl shadow-md p-6">
                        <h3 class="text-2xl font-bold mb-2">Dados Carregados</h3>
                        <p class="text-slate-600 mb-6">Resumo e valida√ß√µes dos dados importados.</p>

                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg p-6 border-l-4 border-blue-500">
                                <p class="text-sm text-slate-600 font-semibold">Pagamentos</p>
                                <p class="text-4xl font-bold mt-2 text-blue-600" id="countPagamentos">0</p>
                            </div>
                            <div class="bg-gradient-to-br from-purple-50 to-purple-100 rounded-lg p-6 border-l-4 border-purple-500">
                                <p class="text-sm text-slate-600 font-semibold">Verbas</p>
                                <p class="text-4xl font-bold mt-2 text-purple-600" id="countVerbas">0</p>
                            </div>
                            <div class="bg-gradient-to-br from-emerald-50 to-emerald-100 rounded-lg p-6 border-l-4 border-emerald-500">
                                <p class="text-sm text-slate-600 font-semibold">Secretarias</p>
                                <p class="text-4xl font-bold mt-2 text-emerald-600" id="countSecretarias">0</p>
                            </div>
                        </div>

                        <div class="mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                            <p class="text-sm text-blue-900">
                                <span class="font-semibold">üí° Dica:</span> Quando este sistema for produzido, incluiremos 
                                valida√ß√µes avan√ßadas, logs de importa√ß√£o e trilha de auditoria.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Scripts -->
    <script src="js/crypto.js?v=7"></script>
    <script src="js/auth.js?v=7"></script>
    <script src="js/data.js?v=7"></script>
    <script src="js/utils.js?v=7"></script>
    <script src="js/charts.js?v=7"></script>
    <script src="js/ui.js?v=7"></script>
    <script src="js/ui-enhanced.js?v=7"></script>
    <script src="js/app.js?v=7"></script>
</body>
</html>
